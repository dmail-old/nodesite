module.exports = {
	getLogLevel: function(){
		if( this.status >= 500 ){
			return 'error';
		}
		if( this.status >= 400 ){
			return 'warn';
		}
		return 'info';
	},

	getStatusStyle: function(){
		if( this.status >= 500 ){
			return 'red';
		}
		if( this.status >= 400 ){
			return 'yellow';
		}
		if( this.status >= 300 ){
			return 'blue';
		}
		if( this.status >= 200 ){
			return 'green';
		}		
		return 'inherit';
	},

	getLogMessage: function(){
		var level = this.level, message = '';

		if( this.user ){
			message+= '[' + this.user.name + '] ';
		}

		message+= String.setType(this.method, 'pink');
		message+= ' ' + String.setType(this.status, this.getStatusStyle());
		message+= ' ' + String.setType(this.url.pathname, 'pink');

		if( this.args ){
			message+= ' ' + String.setType(this.args, 'b');
		}

		if( this.hasHeader('x-response-time') ){
			message+= ' ' + String.setType(this.getHeader('x-response-time') + 'ms', 'b');
		}

		return message;
	},

	log: function(){
		global.logger.log(
			this.getLogLevel(),
			this.getLogMessage()
		);
	}
};