exports['call fn on property change'] = function(test){
	var model = {}, bind = {};

	test.imports.new(model, 'name').observe(function(change){
		test.equal(this, bind);
		test.equal(change.value, model.name);
		test.equal(change.oldValue, undefined);
		test.equal(change.name, 'name');
		test.equal(change.object, model);
		test.done();
	}, bind);

	model.name = 'damien';
};

exports['change only when property is actually changed'] = function(test){
	var model = {}, observer, lastChange

	observer = test.imports.new(model, 'name');
	observer.open();
	model.name = 'damien';
	lastChange = observer.lastChange;

	model.name = 'damien';
	test.ok(lastChange == observer.lastChange);

	model.name = 0;
	test.ok(lastChange != observer.lastChange);
	lastChange = observer.lastChange;

	model.name = false;
	test.ok(lastChange != observer.lastChange);
	
	test.done();
};

exports['cannot observe non configurable property'] = function(test){
	test.equal(test.imports.new([], 'length').open(), false);
	test.done();
};

exports['cannot observe custom getter or setter'] = function(test){
	test.equal(test.imports.new({get foo(){}}, 'foo').open(), false);
	test.equal(test.imports.new({set foo(value){}, get foo(){}}, 'foo').open(), false);
	test.done();
};

exports['close() delete the property when it does not exists'] = function(test){
	var model = {};

	test.imports.new(model, 'name').open().close();

	test.equal('name' in model, false);
	test.done();
};

exports['close() does not affect the value'] = function(test){
	var model = {};

	var observer = test.imports.new(model, 'name').open();
	model.name = 'damien';
	observer.close();

	test.equal(model.name, 'damien');
	test.done();
};

exports['prototypal inheritance when proto & child are observed'] = function(test){
	var proto = {};
	var childProto = Object.create(proto);
	var protoObserver = test.imports.new(proto, 'name');
	var childObserver = test.imports.new(childProto, 'name');

	protoObserver.open();
	childObserver.open();

	proto.name = 'sandra';
	test.equal(protoObserver.lastChange.type, 'add');
	test.equal(childProto.name, 'sandra');

	child.name = 'damien';
	test.equal(childObserver.lastChange.value, 'damien');
	test.equal(proto.name, 'sandra');
	test.equal(proto.name, 'damien');

	test.done();
};

exports['prototypal inheritance when proto is observed'] = function(test){
	var proto = {};
	var childProto = Object.create(proto);
	var protoObserver = test.imports.new(proto, 'name');

	protoObserver.open();

	proto.name = 'sandra';
	test.equal(protoObserver.lastChange.type, 'add');
	test.equal(childProto.name, 'sandra');

	child.name = 'damien';
	test.equal(childObserver.lastChange.value, 'damien');
	test.equal(proto.name, 'sandra');
	test.equal(proto.name, 'damien');

	test.done();
};

exports['prototypal inheritance when child is observed'] = function(test){
	var proto = {};
	var childProto = Object.create(proto);
	var protoObserver = test.imports.new(proto, 'name');
	var childObserver = test.imports.new(childProto, 'name');

	childObserver.open();

	proto.name = 'sandra';
	test.equal(protoObserver.lastChange.type, 'add');
	test.equal(childProto.name, 'sandra');

	child.name = 'damien';
	test.equal(childObserver.lastChange.value, 'damien');
	test.equal(proto.name, 'sandra');
	test.equal(proto.name, 'damien');

	test.done();
};
