exports['saved in the propertyDescriptor'] = function(test){
	var a = {};

	var customProperty = Object.defineCustomProperty(a, 'name', {
		cache: true,
		get: function(){
			return 'foo';
		}
	});

	test.equal(Object.getOwnCustomProperty(a, 'name'), customProperty);
};

exports['can be copied by defineProperty'] = function(test){
	var a = {}, b = {};

	var customProperty = Object.defineCustomProperty(a, 'name', {
		get: function(){
			return 'foo';
		}
	});

	Object.defineProperty(b, 'name', Object.getOwnPropertyDescriptor(a, 'name'));
};

exports['customProperty get/set right value'] = function(test, CustomPropertyDefinition){
	var object = {};
	var a = Object.create(object);
	var b = Object.create(object);
	var customProperty = CustomPropertyDefinition.create(object, 'name').define({});

	a.name = 'foo';
	b.name = 'bar';
	test.equal(a.name, 'foo');
	test.equal(b.name, 'bar');
};

exports['observe + unobserve restore the property'] = function(test, CustomPropertyDefinition){
	var object = {};
	var listener = function(){};
	var def = CustomPropertyDefinition.create(object, 'name');

	def.addListener(listener);
	object.name = 'foo';
	def.removeListener(listener);

	test.equal(Object.hasOwnCustomProperty(object, 'name'), false);
};

exports['cache call getter on demand, even on child objects'] = function(test, CustomPropertyDefinition){
	var object = {};
	var count = 0;
	var value;
	var child = Object.create(object);
	var childValue;
	var getterValue = 'foo';

	CustomPropertyDefinition.create(object, 'cached').define({
		get: function(){
			count++;
			return getterValue;
		},
		cache: true
	});

	value = object.cached;
	value = object.cached;
	childValue = child.cached;
	object.cached = 'bar';

	test.equal(value, getterValue);
	test.equal(childValue, getterValue);
	test.equal(child.cached, 'bar');
	test.equal(count, 1);
};

exports['cache of composed properties invalidation'] = function(test, CustomPropertyDefinition){
	var object = {};
	var child = Object.create(object);
	var count = 0;
	var fullName;
	var definition = CustomPropertyDefinition.create(object, 'fullName').define({
		subproperties: ['firstName', 'lastName'],
		get: function(firstName, lastName){
			count++;
			return firstName + ' ' + lastName;
		},
		cache: true
	});

	definition.traceChildren = true;

	object.firstName = 'damien';
	object.lastName = 'maillard';
	fullName = object.fullName;

	test.equal(definition.cache.has(), true);

	object.firstName = 'sandra';
	// firstName of object has been modified, cache for child & object for 'fullName' expires

	test.equal(definition.cache.has(), false);

	child.lastName = 'machefer';
	fullName = child.fullName;
	object.lastName = 'grassiot';

	// lastName of object has been modified but child.lastName exists, cache is still valid
	test.equal(definition.children[0].cache.has(), true);
};