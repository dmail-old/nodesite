/*

name: Object.cloning

provides:
	RegExp.prototype.clone, Date.prototype.clone, Array.prototype.clone

*/

var property = require('property');

var clone = {
	cloneProperty: function(name, object){
		this[name] = clone.cloneProperties(object[name]);
	},

	cloneProperties: function(object){
		var clone = object;

		if( typeof object == 'object' && object != null ){
			if( typeof object.clone == 'function' ) clone = object.clone();
			else{
				clone = {};
				property.forEachOwn(object, clone.cloneProperty, clone);

				// only if es5
				if( !Object.isExtensible(object) ) Object.preventExtensions(clone);
				if( Object.isSealed(object) ) Object.seal(clone);
				if( Object.isFrozen(object) ) Object.freeze(clone);
			}
		}

		return clone;
	},

	cloneNative: function(){
		return this.constructor(this.valueOf());
	}
};

if( 'getOwnPropertyDescriptor' in Object ){

	clone.cloneProperty = function(name, object){
		var objectDescriptor = Object.getOwnPropertyDescriptor(object, name);
		var descriptor = property.cloneDescriptor(objectDescriptor);

		if( 'value' in objectDescriptor ) descriptor.value = clone.cloneProperties(objectDescriptor.value);
		
		Object.defineProperty(this, name, descriptor);		
	};

}

[RegExp, Date, String, Number, Boolean].forEach(function(constructor){
	property.implement(constructor, 'clone', clone.cloneNative);
});

property.implement(Array, 'clone', function(){
	var i = this.length, clone = new Array(i);

	while(i--) clone[i] = clone.cloneProperties(this[i]);

	return clone;
});

module.exports = clone;
