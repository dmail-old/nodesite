var Iterator = require('Iterator');

var MapIterator = function(map, kind){
	this.iteratedObject = map;
	this.nextIndex = 0;
	this.iterationKind = kind;
	this.result = {done: false, value: undefined};
};

var proto = {
	constructor: MapIterator,
	nextIndex: null,
	iteratedObject: null,
	iterationKind: 'key+value',
	result: null,

	next: function(array){
		var index = this.nextIndex, map = this.iteratedObject, length = map.size, itemKind;

		if( index >= length ){
			return this.createResult(undefined, true);			
		}

		this.nextIndex++;
		itemKind = this.iterationKind;

		if( itemKind == 'key' ){
			return this.createResult(map._keys[index], false);
		}

		if( itemKind == 'value' ){
			return this.createResult(map._values[index], false);
		}
		
		return this.createResult([map._keys[index], map._values[index]], false);
	},

	toString: function(){
		return '[object Map Iterator]'; 
	}
};

MapIterator.prototype = Object.create(Iterator);
require('property').implement(MapIterator, proto);

module.exports = MapIterator;