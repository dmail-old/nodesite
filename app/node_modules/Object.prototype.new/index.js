/*

Object.eachPair

provides: pair.eachPair, pair.eachPairIn,

*/

var pair = require('Object.pair');

if( 'getOwnPropertyNames' in Object ){

	pair.eachPair = function(object, fn, bind){
		var names = Object.getOwnPropertyNames(object), name, i, j, parentNames;

		i = 0;
		j = names.length;
		for(;i<j;i++){
			name = names[i];
			fn.call(bind, name, object[name], object);
		}

		while( object = Object.getPrototypeOf(object) ){
			if( object == Object.prototype ) break;
			parentNames = Object.getOwnPropertyNames(object);
			i = 0;
			j = parentNames.length;
			for(;i<j;i++){
				name = parentNames[i];
				if( names.indexOf(name) === -1 ){
					names.push(name);
					fn.call(bind, name, object[name], object);
				}
			}
		}
	};

	/*

	Object.getPropertyOwner = function(object, key){
		while( object ){
			if( Object.prototype.hasOwnProperty.call(object, key) ) return object;
			object = Object.getPrototypeOf(object);
		}
		return null;
	};

	Object.getPropertyDescriptor = function(object, key){
		object = Object.getPropertyOwner(object, key);
		return object ? Object.getOwnPropertyDescriptor(object, key) : null;
	};

	*/

}
else{

	pair.eachPair = function(object, fn, bind){
		for(var key in object) fn.call(bind, key, object[key], object);
		return object;
	};

}

pair.eachPairIn = function(array, fn, bind){
	return this.iteratePair(this.eachPair, array, fn, bind);
};

/*

Object.instance

provides: Object.prototype.supplement, Object.prototype.extend, Object.prototype.new

*/

module.exports = {
	create: Object.create || function(object){
		var F = function(){};
		F.prototype = object;
		return new F();
	},

	supplement: function(){
		pair.eachPairIn(arguments, pair.appendPair, this);
		return this;
	},

	extend: function(){
		var object = this.create(this);

		object.supplement.apply(object, arguments);

		return object;
	},

	// return an instance of this object calling it's init method
	new: function(){
		var instance = this.create(this), init = instance.init;

		if( typeof init == "function" ) init.apply(instance, arguments);

		return instance;
	}
};

Object.implement(module.exports);