var proto = require('proto');
var TemplateGenerator = proto.create({
	Template: require('StringTemplate'),
	template: null,
	array: null, // on utiliseras ptet plutot un iterable
	separator: null,

	init: function(template, separator){
		if( typeof template == 'string' ) template = this.Template.new(template);
		this.template = template;
		this.separator = separator;
	},

	generate: function(value, index, array){
		var result;

		result = this.template.createResult();
		result.scope = value;

		if( this.map ) result = this.map.call(this.bind, result, value, index, this);

		return result;
	},

	generateResults: function(){
		var array = this.array, i = 0, j = array.length, result, results = new Array(j);
		
		for(;i<j;i++){
			results.push(this.generate(array[i], i, array));
		}

		return results;
	},

	toString: function(){
		return this.reduce('toString');
	},

	toStylizedString: function(){
		return this.reduce('toStylizedString');
	}
});

module.exports = TemplateGenerator;