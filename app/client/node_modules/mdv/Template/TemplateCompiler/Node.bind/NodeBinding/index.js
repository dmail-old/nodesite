var proto = require('proto');
var NodeBinding = proto.create({
	Observer: require('Observer').PropertyPathObserver,
	closed: false,
	node: null,
	property: null,
	observer: null,

	init: function(node, property, model, path){
		this.node = node;
		this.property = property;
		this.observer = this.observe(path, model);
	},

	encodeValue: function(value){
		return value === undefined ? '' : String(value);
	},

	valueChanged: function(value){
		this.node[this.property] = this.encodeValue(value);
	},

	onchange: function(change){
		this.valueChanged(change.value);
	},

	observe: function(path, model){
		return this.Observer.new(path, model, this.onchange, this);
	},

	close: function(){
		if( this.closed === false ){
			this.observer.close();
			this.observer = null;
			this.node = null;
			this.closed = true;
		}
	}
});

module.exports = NodeBinding;