require('core/string');
var NodeBinding = require('../NodeBinding');
var proto = require('@dmail/proto');

var AttributeBinding = proto.extend.call(NodeBinding, {
	conditionalEnd: '?',
	conditional: false,

	constructor: function(node, attrName, model, path){
		if( node.nodeType != 1 ){
			throw new TypeError('expect Node.ELEMENT_NODE ' + node.nodeType + ' given');
		}

		this.conditional = attrName.endsWith(this.conditionalEnd);

		if( this.conditional ) {
			node.removeAttribute(attrName);
			attrName = attrName.slice(0, - this.conditionalEnd.length);
		}

		AttributeBinding.super.constructor.call(this, node, attrName, model, path);
	},

	valueChanged: function(value) {
		if( this.conditional ){
			if( value ){
				this.node.setAttribute(this.property, '');
			}
			else{
				this.node.removeAttribute(this.property);
			}
		}
		else{
			this.node.setAttribute(this.property, this.encodeValue(value));
		}
    }
});

module.exports = AttributeBinding;