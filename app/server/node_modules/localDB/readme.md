localDB
======================

localDB is an embedded JavaScript database for Node.js, it store data locally in files.

## Example

```javascript
var localDB = require('localDB');
// db data will be stored in the ./data folder
var db = localDB.new('./data');

var user = db.table('user');

user.insert({name: 'damien', color: 'red'}, function(error, user){});
user.find('name:damien', function(error, user){});
user.update('name:damien', {name: 'foo'}, function(error, users){});
user.remove('name:damien', function(error, user){});
```

## Data format

First line is column names and next lines are the rows.  
A line is an array in JSON format ending by ',\n'

## `user` table

```
["id","name","email","password"],
[0,"dam","dam@dam.fr","xqj132kljskl"],
[1,"test","test@test.com", "qjsqj567856"]
```

## `user.session` table (1:1 relationship)

```
["id","user","ctime","mtime"],
["dsjpoijqio",0,"2014-27-04 16:10:23.12389" , "2014-27-04 16:10:23.12389"]
```

## `user.languages` table (1:n relationship)

```
["id","user","language"],
[0,0,"fr"],
[0,0,"en"]
```

## Rows format

Multiple rows returns an iterable cursor object : 

```javascript
user.findAll('name = ?', 'dam', function(error, cursor){
	cursor.headers; // ['id', 'name', 'email', 'password']
	cursor.records; // [0, 'dam', 'dam@dam.fr', 'xqj132kljskl']
	
	cursor.length; // 1
	cursor.values().next(); // [0, 'dam', 'dam@dam.fr', 'xqj132kljskl']
	cursor.entries().next(); // {id: 0, 'name': 'dam', 'email': 'dam@dam.fr', 'password': 'xqj132kljskl'}
});
```

## Foreign key

```javascript
user.find('name = ? AND session.ctime < ?', 'dam', Date.now(), function(error, user){});
```

When `session.ctime' is encountered, as `session` is not a user property and is a table name it's considered a foreign key.

## Populate reference of joined table

DEPRECATED with the cursor API, it will be updated later

You have to manually populate data coming from other tables.  
It seems annoying at first glance but it gives full control on data.

```javascript
user.find('name = ?', 'dam', function(error, user){

	db.table('user.languages').findAll('user', user.id, function(error, languages){
		/*
		languages = [
			['id', 'user', 'value'],
			[0, 0, 'fr'],
			[1, 0, 'en']
		];
		*/

		var headers = languages.shift(), i, j = headers.length;

		languages = languages.map(function(values, index){
			var language = {};
			i = 0;
			for(;i<j;i++){
				language[headers[i]] = values[index];
			}

			return language;
		});

		/*
		languages = [
			{id: 0, user: 0, value: 'fr'},
			{id: 1, user: 0, value: 'en'}
		]
		*/
	});

});
```

## Requirements

TODO

## new(directoryPath)

Create a new dabatase at directoryPath.

## table(tableName)

Returns a [table](./DBTable) object used to manipulate table data.
