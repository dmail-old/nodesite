var Iterator = require('iterator');
var proto = require('@dmail/proto');

var CursorIterator = proto.extend.call(Iterator, {
	iteratedObject: null,
	iterationKind: 'value',
	nextIndex: null,
	result: null,

	constructor: function(cursor, kind){
		this.iteratedObject = cursor;
		this.iterationKind = kind || 'value';
		this.nextIndex = 0;
		this.result = {done: false, value: undefined};
	},

	createResult: function(value, done){
		var result = this.result;

		result.value = value;
		result.done = done;

		return result;
	},

	next: function(){
		var index = this.nextIndex, cursor = this.cursor, length = cursor.length, itemKind;

		if( index >= length ){
			return this.createResult(undefined, true);
		}

		this.nextIndex++;
		itemKind = this.iterationKind;

		if( itemKind == 'value' ){
			return this.createResult(cursor.values[index], false);
		}
		if( itemKind == 'entry' ){
			return this.createResult(cursor.toEntry(cursor.values[index]), false);
		}
	}
});

module.exports = CursorIterator;