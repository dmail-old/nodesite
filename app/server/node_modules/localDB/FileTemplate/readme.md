FileTemplate
========================

Manipulate file content part by part.

## Requirements

TODO

## Properties

name | description | default
---- | ------------ | --
fileSystem | fileSystem module used | require('fs')
path | path of the file, can be : 'closed','opening','opened','reading','readed','writing','closing' | 'closed'
fd | fileDescriptor of the file (set when file is opened) | null
stat | [fsStat](http://nodejs.org/api/fs.html#fs_class_fs_stats) object of the file (set when file is read) | null
size | size of the file (set when stat is set) | null
separator | string used to split the file content | '\n'
separatorBuffer | buffer representing the separator string (set when file is opened) | null
parts | Array of parts (set when file is read) | null

## new(path, encoding)

path must be a string and will be considered as the file path.
if encoding is a string encoding property will be set if [Buffer.isEncoding(encoding)](http://nodejs.org/api/buffer.html#buffer_class_method_buffer_isencoding_encoding) returns true.

## open(callback, bind)

Open the file for reading and writing.
callback will receive (error, fileDescriptor)

```javascript
fileTemplate.open(function(error, fileDescriptor){
  if( error.message == FileTemplate
========================

Manipulate file content part by part.

## Requirements

TODO

## Properties

name | description | default
---- | ------------ | ----------
fileSystem | fileSystem module used | require('fs')
path | path of the file, can be : 'closed','opening','opened','reading','readed','writing','closing' | 'closed'
fd | fileDescriptor of the file (set when file is opened) | null
stat | [fsStat](http://nodejs.org/api/fs.html#fs_class_fs_stats) object of the file (set when file is read) | null
size | size of the file (set when stat is set) | null
separator | string used to split the file content | '\n'
separatorBuffer | buffer representing the separator string (set when file is opened) | null
parts | Array of parts (set when file is read) | null

## new(path, encoding)

path must be a string and will be considered as the file path.
if encoding is a string encoding property will be set if [Buffer.isEncoding(encoding)](http://nodejs.org/api/buffer.html#buffer_class_method_buffer_isencoding_encoding) returns true.

## setPath(path)

set the path property

## open(callback, bind)

Open the file for reading and writing.

```javascript
fileTemplate.open(function(error, fileDescriptor){
	if( error ){
		if( error.message == 'file already open' ){
		  // file state isn't 'closed'
		}
		else{
		  // an error occured in Node.js [fs.open](http://nodejs.org/api/fs.html#fs_fs_open_path_flags_mode_callback)
		}
	}	
});
```

## close(callback, bind)

Close the file and clean()

```javascript
fileTemplate.close(function(error){
	if( error ){
		if( error.message == 'file not opened' ){
		  // file state isn't 'opened' or 'readed'
		}
		else{
			// an error occured in Node.js [fs.close](http://nodejs.org/api/fs.html#fs_fs_close)
		}
	}
});
```

## read(callback, bind)

Read the file content and split it into part objects.

test.txt file
```text
Hello
World
!
```

```javascript
fileTemplate.close(function(error, parts){
	if( error ){
		if( error.message == 'file not opened' ){
		  // file state isn't 'opened'
		}
		else{
			// an error occured in Node.js [fs.fstat](http://nodejs.org/api/fs.html#fs_fs_fstat) or [fs.read()](http://nodejs.org/api/fs.html#fs_fs_read)
		}
	}

	parts.length; // 3
  	parts[0].source.toString(); // 'Hello'
  	parts[1].source.toString(); // 'World'
});
```

## write(buffer, byte, callback, bind)

Write buffer starting from byte.

```javascript
fileTemplate.write(new Buffer('Hello world'), 0, function(error){
	if( error ){
		if( error.message == 'can\'t write: file not in readed state' ){
		  // file state isn't 'readed'
		}
		else{
			// an error occured in Node.js [fs.write](http://nodejs.org/api/fs.html#fs_fs_write) 
		}
	}
	// write was successfull
});
```

## clean()

Set state to 'closed' and part, fd, stat and size to null

## unlink()

Delete the file from the fileSystem.  
Equivalent of Node.js [fs.unlink](http://nodejs.org/api/fs.html#fs_fs_unlink) but call clean() if file is sucessfully deleted.

## appendPart(part, callback, bind)

Write the part at the end of the file.

```javascript
fileTemplate.appendPart(fileTemplate.createPart('yo'), function(error, part){});
```

test.txt file
```
Hello
World
yo
````

## replacePart(oldPart, part, callback, bind)

Replace oldPart by part in the file.

```javascript
fileTemplate.replacePart(fileTemplate.parts[1], fileTemplate.createPart('foo bar'), function(error, part){});
```

test.txt file
```
Hello
foo bar
yo
````

## removePart(part, callback, bind)

Remove part from the file.

```javascript
fileTemplate.replacePart(fileTemplate.parts[1], function(error, part){});
```

test.txt file
```
Hello
yo
````

## Undocumented internal functions

- setPath(path)
- reply(callback, bind)
- onopen(...)
- onread(...)
- onclose(...)
- onwrite(error, written, buffer)
- createPart(...)
- indexOf(buffer, search, from)
- splitBuffer(buffer)
- truncateThenWrite(byte, buffer, callback, bind)
- listBufferFrom(index)
- isPart(part)
- checkPart(part)
```