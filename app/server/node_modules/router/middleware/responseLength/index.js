module.exports = {
	name: 'responseLength',
	response: {
		autoLength: true, // computeLength from response stream
		//generatingLength: false,

		get length(){
			return this.hasHeader('content-length') ? parseInt(this.getHeader('content-length'), 10) : 0;
		},

		set length(length){
			this.setHeader('content-length', length);
		}
	},

	handle: function(handler){
		handler.addTask(function(response){
			if( !response.hasBody() || response.hasHeader('content-length') || !response.autoLength ) return response;

			//response.generatingLength = true;
			return response.createBodyPromise().then(function(buffer){
				response.length = buffer.length;
				return response;
			});
		});
	}
};