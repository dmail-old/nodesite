require('promise/fromStream');

module.exports = {
	name: 'requestBody',
	requires: 'requestNegotiation',

	request: {
		parsers: require('./parsers'),
		body: null
	},

	handle: function(handler){
		var request = handler.request;
		var stream, mediaType = request.mediaType;
		
		return Promise.fromStream(request.stream).then(function(body){
			request.body = body.toString();

			if( mediaType in request.parsers ){
				request.bodyParams = request.parsers[mediaType](request.body);
			}
		});
	}
};