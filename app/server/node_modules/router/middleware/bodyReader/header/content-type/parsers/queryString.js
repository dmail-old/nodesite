var QueryString = require('querystring');

module.exports = function(){

	var bodyReader = this.bodyReader;
	var stream = bodyReader.computedStream;

	stream.resolve();
	global.streamToBuffer(stream, function(error, buffer){
		if( error ) return bodyReader.error(error);		

		var queryString = buffer.toString();

		try{
			queryString = QueryString.parse(queryString);
		}
		catch(e){
			return bodyReader.error(error);
		}

		bodyReader.done(queryString);
	});
	
};