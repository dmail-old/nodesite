function HashVerifiedStream(hash, value){
	hash.on('end', function(){
		var digest = this.digest();
		if( digest != value ){
			this.emit('error', this.createBadDigestError(digest, value));
		}
	});

	hash.createBadDigestError = function(digest, value){
		var error = new Error('bad digest');
		error.value = value;
		error.digest = digest;
		return error;
	};

	return hash;
}

module.exports = HashVerifiedStream;