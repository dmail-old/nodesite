var ResponseHeader = require('./responseHeader');
var ContentLength = ResponseHeader.extend({
	name: 'content-length',

	generate: function(){
		var self = this, bodyWriter = self.bodyWriter, response = self.response, length = 0;

		response.wait(function(done){
			
			bodyWriter.computedStream.on('data', function(chunk){
				length+= chunk.length;
			});
			bodyWriter.computedStream.on('end', function(){
				response.setHeader(self.name, length);
				done();
			});

		});
	}
});

module.exports = ContentLength;