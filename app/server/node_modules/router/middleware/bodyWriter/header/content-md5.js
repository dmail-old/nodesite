var ResponseHeader = require('./responseHeader');
var ContentMD5 = ResponseHeader.extend({
	name: 'content-md5',

	generate: function(){
		var self = this, bodyWriter = self.bodyWriter, response = this.response,
		hash = require('crypto').createHash('md5');

		response.wait(function(done){
			
			bodyWriter.computedStream.on('data', function(chunk){
				hash.update(chunk);
			});
			bodyWriter.computedStream.on('end', function(){
				response.setHeader(self.name, hash.digest('base64'));
				done();
			});

		});
	}
});

module.exports = ContentMD5;