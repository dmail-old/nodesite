var BodyGenerator = {
	constructor: function(){
		this.buffers = [];
		this.length = 0;
	},

	ondata: function(chunk, encoding){
		this.buffers.push(chunk);
		this.length+= chunk.length;
	},

	onend: function(){
		var body = Buffer.concat(this.buffers, this.length);
		this.response.body = body.toString();
	}
};

module.exports = {
	name: 'responseBody',
	response: {
		captureBody: function(){
			if( this.hasBody() ){
				this.prefetch(BodyGenerator);
			}
		}
	},

	handle: function(handler){
		var response = handler.response;
		response.on('beforeSendingHeaders', response.captureBody);
	}
};