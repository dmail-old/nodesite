/*



*/

require('@dmail/object/assign');

var Path = require('path');
var proto = require('@dmail/proto');
var GZIPAlias = proto.extend({
	constructor: function(fileHandler){
		this.fileHandler = fileHandler;
	},

	handle: function(){
		var extension = Path.extname(this.fileHandler.path);
		return (extension == '.js' || extension == '.css') && this.fileHandler.acceptGzip;
	},

	getPath: function(path){
		return path + '.gz';
	},

	found: function(){
		// devrait envoyer setHeader('vary', 'accept-encoding');
		Object.assign(this.fileHandler.result, {
			// specifiy the body is already gzip encoded
			bodyEncoding: 'gzip',
			// force response to be gzip encoded (it will just set header as body is already gzip encoded)
			encoding: 'gzip'
		});
	}
});

module.exports = GZIPAlias;