module.exports = {
	name: 'response-final',

	properties: {
		sendTime: true
	},

	constructor: function(){
		this.startDate = new Date();
	},

	task: function(){
		// IRRELEVANT?? AJAX request need a 200 statusCode to read the response
		/*
		if( this.status < 200 && this.status >= 400 && this.request.isAjax() ){
			this.setHeader('x-status-code', this.status); // error status are put in a header
			this.status = 200;
		}
		*/

		// il ne faut faire ça qu'au moment où la réponse est prête (après autoEncoding, autoLength etc)
		if( this.sendDate && !this.hasHeader('date') ){
			this.setHeader('date', new Date().toUTCString());
		}

		if( this.sendTime ){
			this.setHeader('x-response-time', new Date() - this.startDate);
		}

		// there is a body without content-length header, tell that to the browser
		if( !this.hasHeader('content-length') ){
			this.setHeader('transfer-encoding', 'chunked');
			//this.setHeader('accept-ranges', 'bytes');
		}
	}
};