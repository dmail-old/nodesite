var Request = require('../request');

exports['request.bytesReceived must match request.length'] = function(test, RequestLength){
	var goodRequest = Request.create(), body = 'hello world', badRequest = Request.create();

	goodRequest.addPlugin(RequestLength);
	badRequest.addPlugin(RequestLength);

	goodRequest.resolve({
		body: body,
		length: body.length
	});

	badRequest.resolve({
		body: body,
		length: 1
	});

	test.willBe(goodRequest.consume().then(function(){ return goodRequest.bytesReceived; }), body.length);
	test.willBe(badRequest.consume().catch(function(error){ return error.code; }), 'BAD_SIZE');
};

exports['request body length must not exceed request.bytesLimit'] = function(test, RequestLength){
	var request = Request.create();
	var body = 'hello world';

	request.addPlugin(RequestLength);

	request.resolve({
		body: body,
		bytesLimit: 5
	});

	test.willBe(request.consume().catch(function(error){ return error.code; }), 'TOO_LARGE');
};
