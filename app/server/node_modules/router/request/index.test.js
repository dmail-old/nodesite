exports['stream consumption tests'] = function(test){
	var stream = require('stream');
	var PassThrough = stream.PassThrough;
	var streamA = new PassThrough();
	var streamB = new PassThrough();

	streamA.pause();
	streamA.write('coucou');
	streamA.end();
	streamA.resume();

	test.resolveTo(new Promise(function(resolve){
		streamA.on('data', function(data){ resolve(data.toString()); });
	}), 'coucou');
};

exports['resolve() fullfill the request.ready() promise'] = function(test, Request){
	var request = Request.create();

	request.resolve();
	test.willResolve(request.ready());
};

exports['stream can be consumed multiple times'] = function(test, Request){
	var request = Request.create();

	request.resolve({
		body: 'hello world'
	});

	test.resolveTo(request.consume().then(String), 'hello world');
	test.resolveTo(request.consume().then(String), 'hello world');
};
