var Request = require('../request');

exports['request md5'] = function(test, RequestMD5){
	var MD5Request = Request.extendProto(RequestMD5);
	var goodRequest = MD5Request.create();
	var badRequest = MD5Request.create();
	var body = 'hello world';
	var md5 = require('crypto').createHash('md5').update(body).digest('base64');

	goodRequest.resolve({
		body: body,
		md5: md5
	});

	badRequest.resolve({
		body: body,
		md5: 'yo'
	});

	test.willBe(goodRequest.consume().then(function(){ return goodRequest.bodyMD5; }), md5);
	test.willBe(badRequest.consume().catch(function(error){ return error.code; }), 'BAD_DIGEST');
};