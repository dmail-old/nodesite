require('promise/fromStream');

module.exports = {
	name: 'request-body',

	properties: {
		parsers: require('./parsers'),
	},

	task: function(){
		var request = this, mediaType = this.mediaType;

		if( mediaType && mediaType in request.parsers ){
			return Promise.fromStream(request.stream).then(function(buffer){
				var body = buffer.toString();

				request.body = body;
				request.bodyParams = request.parsers[mediaType](body);
			});
		}
	}
};