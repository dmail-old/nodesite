var Module = require('./Module');

var headers = {
	module: 'x-module',
	resolve: 'x-resolve',
	resolveParent: 'x-resolve-parent'
};

module.exports = {
	Module: Module,

	handle: function(router){
		var Path = require('path'), request, response, module;

		request = router.request;
		response = router.response;

		if( request.hasHeader(headers.resolve) ){
			path = request.getHeader(headers.resolveParent);
			module = Module.new(path);
			
			module.resolve(request.getHeader(headers.resolve), function(error, filename){
				if( error ){
					response.error(error);
				}
				else{
					response.end(filename);
				}
			});
		}
		else if( request.hasHeader(headers.module) ){
			path = request.getHeader(headers.module);
			module = Module.new(path);

			response.sendFile(module.filename);
		}
		else{
			router.next();
		}
	}
};