module.exports = {
	request: {
		defaultMediaType: 'application/octet-stream', // RFC2616 section 7.2.1
		parsers: require('./parsers'),
		bodyParams: null,

		get mediaType(){
			if( this.hasHeader('content-type') ){
				return this.parseContentType(this.getHeader('content-type'))[0];
			}
			return this.defaultMediaType;
		}
	},

	handle: function(router){
		var request = router.request, stream = request.stream, mediaType;

		if( stream ){
			mediaType = request.mediaType;

			if( mediaType in request.parsers ){
				request.parsers[mediaType](stream, function(error, params){
					if( error ){
						router.error(error);
					}
					else{
						request.bodyParams = params;
						router.next();
					}
				});
			}
		}
	}
};