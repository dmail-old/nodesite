var streamToBuffer = require('streamToBuffer');

module.exports = function(stream, fn){
	streamToBuffer(stream, function(error, buffer){
		if( error ) return fn(error);

		var json = buffer.toString();

		try{
			json = JSON.parse(json);
		}
		catch(e){
			return fn(e);
		}

		fn(null, json);
	});
};