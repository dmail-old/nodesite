var streamToBuffer = require('Stream-util').toBuffer;
var QueryString = require('querystring');

module.exports = function(stream, fn){
	streamToBuffer(stream, function(error, buffer){
		if( error ) return fn(error);

		var queryString = buffer.toString();

		try{
			queryString = QueryString.parse(queryString);
		}
		catch(e){
			return fn(e);
		}

		fn(null, queryString);
	});
};