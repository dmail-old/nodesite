var Router = require('Router');

Router.PARAMS.SESSION = 'session';

module.exports = {
	request: {
		user: null,
	},

	handle: function(router){
		var request = router.request;
		var session = request.cookieParams[router.PARAMS.SESSION];

		if( !session ) return router.next();

		request.user = router.database.find('user', 'session:' + session, function(error, user){
			if( error ){
				router.next(error);
			}
			else{
				request.user = user;
				router.next();
			}
		}, request);
	}
};