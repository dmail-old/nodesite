function parseJSON(json, urlEncoded){
	if( urlEncoded ){
		json = require('querystring').unescape(json);
	}
	
	json = JSON.parse(json);	

	return json;
}

module.exports = {
	handle: function(request, response, handler){
		var urlParams, bodyParams;

		urlParams = request.urlParams;
		if( urlParams && urlParams.json ){
			urlParams.json = parseJSON(urlParams.json, true);
		}

		bodyParams = request.bodyParams;
		if( bodyParams && bodyParams.json ){
			// decode URI component on json URI encoded string
			if( request.mediaType == 'application/x-www-form-urlencoded' ){
				bodyParams.json = parseJSON(bodyParams.json, true);
			}
			else{
				bodyParams.json = parseJSON(bodyParams.json);
			}
		}

		handler.next();
	}
};