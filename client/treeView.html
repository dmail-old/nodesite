<script>
var data = {
	name: 'collection',
	childNodes: [
		{name: 'node0', childNodes: [{name: 'node0.1'}]},
		{name: 'node1'},
		{name: 'node2', childNodes: [{name: 'node2.1'}, {name: 'node2.2'}]},
		{name: 'node3', childNodes: [{name: 'node3.1'}]}
	]
};
var nodeModel = NS.modelDocument.createNode('node', data);
var treeView = NS.viewDocument.createNode('tree');
var nodeView = NS.viewDocument.createNode('node', nodeModel);

treeView.insertElement(document.body);
treeView.appendChild(nodeView);

//treeView.control('nav');

nodeView.expand();
nodeView.childNodes[0].expand();
nodeView.childNodes[2].expand();
nodeView.childNodes[3].expand();

// grâce à ceci on devrait pouvoir éviter de conserver le tableau visibles
NS.View.isVisible = function(){
	var parent = this;

	if( this.hasClass('hidden') ) return false;

	while(parent = parent.parentNode){
		if( parent == null || parent.parentNode == null ) return true;
		if( parent.hasClass('hidden') || !parent.hasClass('expanded') ) return false;
	}

	return true;
};

function filter(view){
	return view.isVisible() ? NS.Filter.ACCEPT : NS.Filter.REJECT;
}

console.log('firstvisibleview of root', treeView.getFirstNode(filter).element);
console.log('lastvisibleview of root', treeView.getLastNode(filter).element);

</script>
