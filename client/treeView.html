<script>
var treeData = {
	name: 'collection',
	children: [
		{name: 'node0', children: [{name: 'node0.1'}]},
		{name: 'node1'},
		{name: 'node2', children: [{name: 'node2.1'}, {name: 'node2.2'}]},
		{name: 'node3', children: [{name: 'node3.1'}]}
	]
};
var model = NS.TreeModel.new(treeData);
var view = NS.NodeTreeView.new(model);
var rootView = NS.RootTreeView.new();

rootView.eventListener.handlers = {};

NS.IndentController.new(rootView);

NS.StateController.new(rootView, 'lighted');
rootView.eventListener.handlers.mouseover = function(e){
	var view = this.cast(e) || this;

	// when light only occur on the name element
	if( view != this && this.hasClass('compact') && e.target != view.getDom('name') ){
		view = this;
	}

	view.light(e);
};
rootView.eventListener.handlers.mouseout = function(e){
	// when the mouse go very fast out of the view mouseover event is'nt fired
	// on other view (event the parent view)
	// but we can check the relatedTarget to see if the mouse go out of all view
	var view = this.cast(e.relatedTarget);

	if( !view ){
		this.unlight(e);
	}
};

NS.StateController.new(rootView, 'focused');

NS.StateController.new(rootView, 'selected');
rootView.classList.add('unselectable');

NS.ExpandController.new(rootView);

rootView.eventListener.handlers.mousedown = function(e){
	var view = this.cast(e) || this;

	view.focus(e);
	view.select(e);
	if( e.target.hasClass('tool') ){
		view.toggleState('expanded', e);
	}
};
rootView.eventListener.handlers.dblclick = function(e){
	var view = this.cast(e) || this;

	// le futur menu contextuel doit prendre le pas sur ce dblclick
	if( !e.target.hasClass('tool') ){
		view.toggleState('expanded', e);
	}
};

var visibles = NS.VisiblesController.new(rootView);

//NS.MousedownmultiselectTreeController.new(rootView); // 'mousedownselect');
//NS.MousedownfocusTreeController.new(rootView);
//NS.NavController.new(rootView);

rootView.insertElement(document.body);
rootView.appendChild(view);

view.expand();
view.children[0].expand();
view.children[2].expand();
view.children[3].expand();

/*
var FileModel = new NS({
	Extends: NodeModel,
	Implements: Model.serverMethods,

	initialize: function(path){
		NodeModel.prototype.initialize.call(this, typeof path == 'string' ? {path: path} : path);
	},

	sync: function(action, callback){
		server.applyAction('filesystem/' + action.name, action.args, callback);
	},

	rename: function(name, callback){
		return this.send('rename', [this.get('path'), name], callback);
	}
});

NodeView.prototype.modelEvents.send = function(){
	// on n'affiche pas le loader tout de suite, uniquement si l'action dure
	this.timeout = setTimeout(function(){
		delete this.timeout;
		this.getDom('li').addItem('loading');
	}.bind(this), 300);
};

NodeView.prototype.modelEvents.complete = function(){
	if( this.timeout ){
		clearTimeout(this.timeout);
		delete this.timeout;
	}
	this.getDom('li').removeItem('loading');
};

var imgA = new FileModel('/img/aa');
imgA.rename('bb');

*/
</script>
