<script>
var data = {
	name: 'collection',
	children: [
		{name: 'node0', children: [{name: 'node0.1'}]},
		{name: 'node1'},
		{name: 'node2', children: [{name: 'node2.1'}, {name: 'node2.2'}]},
		{name: 'node3', children: [{name: 'node3.1'}]}
	]
};
var nodeModel = NS.modelDocument.createNode('node', data);
var rootView = NS.viewDocument.createNode('root');
var nodeView = NS.viewDocument.createNode('node', nodeModel);

rootView.insertElement(document.body);
rootView.appendChild(nodeView);

rootView.control('indent');
rootView.control('visibles');
rootView.control('lighted');
rootView.control('focused');
rootView.control('expanded');
rootView.control('selection');
rootView.addClass('unselectable');
//rootView.control('nav');

nodeView.expand();
nodeView.children[0].expand();
nodeView.children[2].expand();
nodeView.children[3].expand();

/*
Comment faire en sorte que ce qui suit soit
- Réutilisable
	-> selection utilisé par treeview et aussi par selectView
	(qui en fait est un treeview wrapper dans un conteneur)
- Modulable
	-> sélection on écoute mousedown mais focus écoute aussi mousedown
	idéalement faudrais séparer le code qui n'a pas vraiment de point commun

Sachant que le code appartiendras dorénavant aux vues

*/

// lighted
rootView.eventListener.set('mouseover', function(e){
	var view = this.cast(e.target);

	// when light only occur on the name element
	if( view != this && this.hasClass('compact') && e.target != view.getDom('name') ){
		view = this;
	}

	if( view == this ){
		this.emit('unlightAll', e);
	}
	else{
		view.light(e);
	}
});
rootView.eventListener.set('mouseout', function(e){
	// when the mouse go very fast out of the view mouseover event is'nt fired
	// on other view (event the parent view)
	// but we can check the relatedTarget to see if the mouse go out of all view
	var view = this.cast(e.relatedTarget);

	if( !this.contains(view) ){
		this.emit('unlightAll', e);
	}
});


// selected, focused, expanded
rootView.eventListener.set('mousedown', function(e){
	var view = this.cast(e);

	view.focus(e);
	view.select(e);
	if( e.target.hasClass('tool') ){
		view.toggleState('expanded');
	}
});
rootView.eventListener.set('click', function(e){
	var view = this.cast(e);

	if( view == this ){
		this.emit('unselectAll', e);
	}
	else{
		view.bubble('collapse', e);
	}
});
rootView.eventListener.set('dblclick', function(e){
	// le futur menu contextuel doit prendre le pas sur ce dblclick
	if( !e.target.hasClass('tool') ){
		this.cast(e).toggleState('expanded');
	}
});

// expanded, nav, selection
rootView.eventListener.set('keydown', function(e){
	if( e.control && e.key == 'a' ){
		this.emit('selectAll', e);
	}
});

</script>
