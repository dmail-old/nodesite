var StringFormattedStream = require('./StringFormattedStream');

var JSONStream = StringFormattedStream.create({
	stringify: function(log){
		return JSON.stringify(log);
	}
});

var RawStream = StringFormattedStream.create({
	stringify: function(log){
		return log.toString();
	}
});

var ColoredStream = StringFormattedStream.create({
	stringify: function(log){
		return log.toStylizedString();
	}
});

var JSONParsedStream = require('./JSONParsedStream');
var LogStream = JSONParsedStream.create({
	reviveLogFromData: function(data){
		if( 'string' in data && 'scope' in data && 'level' in data ){
			var log = this.Log.new();
			log.populate(data);
			return log;
		}
		return data;
	},

	reviver: function(key, value){
		if( key === '' ){
			value = this.reviveLogFromData(value);
		}
		else if( Array.isArray(value) ){
			value = value.map(this.reviveLogFromData, this);
		}
		return value;
	}
});

module.exports = {
	json: JSONStream,
	raw: RawStream,
	colored: ColoredStream
};