var proto = require('@dmail/proto');
var StringTemplate = require('template-string');

var TerminalTemplate = proto.extend({
	template: null,
	stream: null,
	minInterval: 100,

	constructor: function(template, stream){
		this.template = StringTemplate.create(template);
		this.stream = stream || process.stdout;
	},

	update: function(scope, force){
		this.template.exec(scope);
		this.write(force);
	},

	write: function(force){
		var date = new Date();

		if( this.written ){
			if( !force && date - this.lastWriteDate < this.minInterval ){
				return;
			}

			this.stream.clearLine();
			//this.stream.moveCursor(0, 0);
			this.stream.cursorTo(0);
		}

		this.stream.write(this.template.toString());
		this.written = true;
		this.lastWriteDate = date;
	}
});

module.exports = TerminalTemplate;