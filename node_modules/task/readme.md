# task

A task looks like a promise with pause/resume/cancel/progress mecanism.
It's one of the most wonderful thing in the world, yes, it is.

Inspired by https://github.com/petkaantonov/bluebird/blob/master/API.md#all---promise

## Example

Increase the id of a JSON file containing `{"id": 0}`

```javascript
var path = 'file.json', task;
function createReadFilePromise(path){}
function createWriteFilePromise(path, content){}

task = Task.pipe([
  createReadFilePromise,
  JSON.parse,
  function(content){
    content.id++;
    return content;
  },
  JSON.stringify,
  createWriteFilePromise.bind(null, path)
], null, path);
```

## properties

Name  | Description | Default
----- | --- | ---------
state | Can be 'pending', 'completed', 'failed' | 'pending'
isPaused  | Boolean indicating if the task is paused | false
isCancelled | Boolean indicating if the task is cancelled | false
previous | The task executed before this one | null
next | The task to execute after this one | null
value | Value of this task | null

## chain(task)

Set the next task to execute after this one. Throw an error when called twice on the same task.

```javascript
var taskA = new Task(), taskB = new Task();

task.chain(taskB);
taskA.complete('foo');
taskB.value; // 'foo'
```

## insert(task)

Replace or set the next task to execute after this one.

```javascript
var taskA = new Task(), taskB = new Task(), taskC = new Task();

taskA.chain(taskB);
taskA.insert(taskC); // you can also write taskA.complete(taskC)
taskA.next; // taskC
taskA.next.next; // taskB
```

## Before going further

The term task state refers to the completed/failed/cancelled/paused state of a task.
The term task chain refer to the chain formed by previous & next properties.
**The task state is propaged on the task chain**

## cancel()

The task will never complete or fail

## pause()

The task completion/failure is ignored until task.resume()

## resume()

Reconsider task completion/failure. If the task has completed/failed while paused, it complete/fails immediatly

## complete(value)

Initiate the task completion with the provided value

## fail(value)

Initiate the task failure with the provided value

## adopt(otherTask)

The task will adopt otherTask state as soon as possible.

## join(completionTransformer, failureTransformer, bind)

Create a task adopting the state of this one asap.
The created task is added to the task chain.
completionTransformer(value) & failureTransformer(value) are optional function used to transform the value of this.

```javascript
var taskA = new Task().complete('foo');
var taskB = taskA.join(function(value){
  return value + 'bar';
});

taskB.join(console.log); // 'foobar'
```

## then(completionTransformer, failureTransformer, bind)

Same as join but the created task is not added to the task chain, see implications in next part

## The key difference between then() & join()

```javascript
var task = new Task();
var thenedTask = task.then();
var joinedTask = task.join();

thenedTask.cancel(); // cancel thenedTask only
joinedTask.cancel(); // cancel joinedTask & task
```

## Undocumented

- delay(ms)
- timeout(ms)
- spread(onCompletion, onFailure, bind)
- finally(onCompletionOrFailure, bind)

## Static function (helpers)

- Task.complete(value)
- Task.fail(value)
- Task.delay(ms, value)
- Task.all(iterable)
- Task.any(iterable)
- Task.race(iterable)
- Task.pipe(iterable, bind, initialValue)
- Task.map(iterable, fn, bind)
- Task.mapAny(iterable, fn, bind)
- Task.mapRace(iterable, fn, bind)
- Task.reduce(iterable, fn, bind, initialValue)