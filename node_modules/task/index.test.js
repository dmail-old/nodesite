function delayedPromise(ms, value){
	return new Promise(function(res){
		setTimeout(res.bind(null, value), 100);
	});
}

exports['task chaining complete propagation'] = function(test, Task){
	var taskA = new Task(), taskB = new Task();

	taskA.chain(taskB);
	taskA.complete('foo');

	test.resolveTo(taskB, 'foo');
};

exports['task chaining pause/resume propagation'] = function(test, Task){
	var taskA = new Task(), taskB = new Task();

	taskA.chain(taskB);
	taskA.pause();

	test.equal(taskB.isPaused, true);
	taskA.resume();
	test.equal(taskB.isPaused, false);
};

exports['task insertion allow to return task to chain them'] = function(test, Task){
	var task = Task.complete(Task.complete('foo'));

	test.equal(task.next != null, true);
	test.resolveTo(task, 'foo');
};

exports['basic task dependency'] = function(test, Task){
	test.resolveTo(Task.complete(10).then(function(a){
		return a + 20;
	}), 30);
};

exports['complete to a thenable'] = function(test, Task){
	test.resolveTo(Task.complete(Promise.resolve('foo')), 'foo');
};

exports['recover failed task'] = function(test, Task){
	test.resolveTo(Task.fail('foo').catch(function(error){
		return error;
	}), 'foo');
};

exports['fail by consumer'] = function(test, Task){
	test.resolveTo(Task.complete('foo').then(function(){
		return Task.fail('bar');
	}).catch(function(error){
		return error;
	}), 'bar');
};

exports['cancel prevent completion'] = function(test, Task){
	test.remainPending(new Task().cancel().complete('foo'));
};

exports['pause prevent completion & resume restore state'] = function(test, Task){
	var task = new Task();

	task.pause();
	task.complete('foo');
	setTimeout(function(){ task.resume(); }, 100);

	test.resolveIn(task, 100);
};

exports['consumer cancellation'] = function(test, Task){
	test.remainPending(Task.complete('foo').then(function(){
		return new Task().cancel();
	}));
};

exports['cancel propagate cancellation to consumer for then & join'] = function(test, Task){
	var task = new Task().cancel();

	test.remainPending(task.then());
	test.remainPending(task.fork());
};

exports['pause/resume works'] = function(test, Task){
	var task = Task.complete().pause();

	setTimeout(function(){
		task.resume();
	}, 100);

	test.resolveIn(task.then(), 100);
};

exports['delay'] = function(test, Task){
	test.resolveIn(Task.complete().delay(100), 100);
};

exports['delay return value'] = function(test, Task){
	test.resolveTo(Task.complete('foo').delay(100), 'foo');
};

exports['delay cancellation'] = function(test, Task){
	test.remainPending(Task.complete().delay(10).cancel());
};

exports['timeout'] = function(test, Task){
	test.resolveTo(Task.complete().delay(100).timeout(10).catch(function(error){
		return error.code;
	}), 'TASK_TIMEOUT');
};

/*
exports['all'] = function(test, Task){
	var task = Task.all([new Task(), 1, 2]);

	task.tasks[0].complete(0);

	test.resolveTo(task.then(String), '0,1,2');
};

exports['all cancellation'] = function(test, Task){
	test.remainPending(Task.all([1, 2, 3]).cancel());
};

exports['all pausing / resuming'] = function(test, Task){
	var task = Task.all([new Task(), 1, 2]);

	task.pause();
	setTimeout(function(){
		task.resume();
	}, 100);
	task.tasks[0].complete('ok');

	test.resolveIn(task, 100);
};

exports['all fail by consumer'] = function(test, Task){
	var all = Task.all([new Task(), 2, 3]);
	var tasks = all.tasks;

	tasks[0].fail('foo');

	test.resolveTo(all.catch(function(value){ return value; }), 'foo');
};

exports['all cancel by consumer'] = function(test, Task){
	var all = Task.all([new Task(), 2, 3]);
	var tasks = all.tasks;

	tasks[0].cancel();
	all.complete('foo');

	test.remainPending(all);
};
*/