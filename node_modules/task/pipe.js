var Task = require('./task');
require('task/complete');
var forOf = require('for-of');

function pipe(iterable, bind, initialValue){
	var pipedTask = new Task();
	var previous = Task.complete(initialValue);

	forOf(iterable, function(fn){
		var task = new Task();
		task.onCompletion = fn;
		task.bind = bind;

		previous.completed.addOnce(function(){
			task.complete(previous.value);
		});
		previous = task;
	});

	return pipedTask;
}

module.exports = pipe;
Task.pipe = pipe;