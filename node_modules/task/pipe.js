var Task = require('./task');
require('task/complete');
var forOf = require('for-of');

function pipe(iterable, bind, initialValue){
	var pipedTask = new Task('pipedTask');
	var previous = Task.complete(initialValue);

	// c'est exactement comme then mais on adopt sur previous
	// donc y'a un souci Ã  mon avis pipedTask.current est pas correct

	forOf(iterable, function(fn){
		var task = new Task();

		task.name = fn.name;
		task.onCompletion = fn;
		task.bind = bind;
		task.adopt(previous);
		previous = task;
	});

	pipedTask.adopt(previous);

	return pipedTask;
}

module.exports = pipe;
Task.pipe = pipe;