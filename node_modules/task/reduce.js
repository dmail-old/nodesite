var proto = require('proto');
var Task = require('../task');
require('promise/mapReduce');

function reduce(executors, initialValue, reactions){
	return Task.create(function(){

		return Promise.mapReduce(executors, function(executor, index, executors, previous){
			if( index ) this.progress(previous);
			this.task = Task.create(executor, previous, reactions ? reactions[executor.name] : null);
			return this.task; // will be autostarted by parent task

			//this.task.start();
			//return this.task.promise;
		}, this, this.value);

	});
}

Task.reduce = reduce;
module.exports = reduce;