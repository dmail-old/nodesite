var Task = require('task');
require('iterator/map');

function map(iterable, fn, bind){
	/*
	var tasks = [];
	forOf(iterable, function(value){
		tasks.push();	
	});
	return Task.all(tasks);
	*/

	iterable = Iterator.map(iterable, function(value, index, iterable){
		var ret, error;

		try{
			ret = fn.call(bind, value);
		}
		catch(e){
			error = e;
		}

		return error ? Task.fail(error) : Task.complete(ret);	
	}, bind);

	return Task.all(iterable);
}

module.exports = map;
Task.map = map;