var Task = require('./task');
require('task/all');
require('task/exec');
require('iterator/map');

function map(iterable, fn, bind){

	iterable = Iterator.map(iterable, function(value, index, iterable){
		return Task.exec(fn, bind, value);
	}, bind);

	return Task.all(iterable);
}

Task.prototype.map = function(fn, bind){
	return this.then(function(value){
		return map(value, fn, bind);
	});
};

module.exports = map;
Task.map = map;