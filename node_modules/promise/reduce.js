require('promise');
require('Iterator/ArrayIterator');
var forOf = require('forOf');

// each iterable value is considered as a then() call
function reduce(iterable, bind, initialValue){
	var promise = Promise.resolve(initialValue);

	forOf(iterable, function(fn){
		if( typeof bind !== 'undefined' ) fn = fn.bind(bind);
		promise = promise.then(fn);
	});

	return promise;
}

module.exports = reduce;
Promise.reduce = reduce;