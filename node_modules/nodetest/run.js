/*

Idealement, ceci est un stream qui écrit soit que les tests se passent bien
soit qu'une erreur survient

on devrait donc attendre un writableStream et pouvoir le passer comme argument

TODO On observe les tests que lorsqu'ils ont réussi, si un test contient une erreur et est modifié
les tests ne sont pas relancés !

ok il reste :

le redémarrage des tests lorsque module/fichier est modifié
gérer le cas ou la modif du module/fichier génère une erreur

*/

var options = {
	autoWatch: true,
	//profile: false,
	path: '',
};

var PATH = require('path');

if( process.argv[2] ) options.path = PATH.resolve(process.cwd(), process.argv[2]);
//if( process.argv.indexOf('--profile') ) options.profile = true;

var nodetest = require('../nodetest');
var LogStream = require('LogStream');
var logger = new LogStream();

if( options.autoWatch ){
	require('net').createServer().listen(); //process.stdin.resume(); // keep process alive
}

nodetest.testFolder(options.path, logger, options.autoWatch);

/*
MORE : quelque chose dans ce gout là pour n'éxécuter les tests qu'une fois
if( process.argv[3] == 'true' ) test.onend = process.exit
*/