var TestSerie = require('../TestSerie');
var proto = require('proto');

var FileTest = proto.extend(TestSerie, {
	type: 'file',
	path: null,

	constructor: function(path){
		TestSerie.call(this);
		this.name = 'Test in file : ' + path;
		this.path = path;
		this.load();
	},

	createTestList: function(){
		var exports = this.exports, tests = [], name;

		for(name in exports){
			tests.push(this.createTest(name, exports[name]));
		}

		return tests;
	},

	setModule: function(module){
		this.module = module;
		this.forEach(function(test){ test.module = module; });
	},

	load: function(){
		delete require.cache[this.path];
		this.exports = require(this.path);
		this.tests = this.createTestList();
		this.setModule(this.module);
	}
});

module.exports = FileTest;