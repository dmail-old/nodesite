var TestSerie = require('../TestSerie');

var FileTest = TestSerie.create({
	type: 'file',
	path: null,

	init: function(path){
		TestSerie.init.call(this);
		this.path = path;
		this.load();
	},

	createTestList: function(){
		var exports = this.exports, tests = [], name;

		for(name in exports){
			tests.push(this.createTest(name, exports[name]));
		}

		return tests;
	},

	setModule: function(module){
		this.module = module;
		this.forEach(function(test){ test.module = module; });
	},

	load: function(){
		delete require.cache[this.path];
		this.exports = require(this.path);
		this.tests = this.createTestList();
		this.setModule(this.module);
	},

	augmentError: function(e){
		e.fileTest = this;
		TestSerie.augmentError.call(this, e);
	}
});

module.exports = FileTest;