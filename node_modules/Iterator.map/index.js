var Iterator = require('Iterator');
var proto = require('proto');

var MappedIterator = proto.extend(Iterator, {
	constructor: function(iterable, map, bind){
		if( typeof map != 'function' ) throw new TypeError('map must be a function');

		this.iterable = iterable;
		this.iterator = iterable[Symbol.iterator]();
		this.map = map;
		this.bind = bind;
		this.index = 0;
	},

	next: function(){
		var next = this.iterator.next();
		if( next.done === true ) return next;
		this.index++;
		next.value = this.map.call(this.bind, next.value, this.index, this.iterable);
		return next;
	},

	toString: function(){
		return '[object Mapped Iterator]';
	}
});

var MappedIterable = proto.create({
	iterable: null,
	map: null,
	bind: null,

	constructor: function(iterable, map, bind){
		this.iterable = iterable;
		this.map = map;
		this.bind = bind;
	},

	toString: function(){
		return '[object Mapped Iterable]';
	}
});

MappedIterable.prototype[Symbol.iterator] = function(){
	return new MappedIterator(this.iterable, this.map, this.bind);
};

Iterator.map = function(iterable, map, bind){
	return new MappedIterable(iterable, map, bind);
};